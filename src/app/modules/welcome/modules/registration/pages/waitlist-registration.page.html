<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" fill="clear">
        <ion-icon name="chevron-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Waitlist Access</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="waitlist-registration-content">
  <div class="container">
    <!-- Header Section -->
    <div class="header-section">
      <div class="logo-container">
        <img src="assets/logo/YAP-LOGO.png" alt="YAP Logo" class="logo">
      </div>
      <h1>Welcome Back!</h1>
      <p class="subtitle">Access your waitlisted YAP account with special rewards</p>
    </div>

    <!-- Security Audit Banner (conditional) -->
    <div *ngIf="securityAudit" class="security-banner" [ngClass]="getSecurityAuditStatusColor()">
      <div class="security-icon">
        <ion-icon *ngIf="securityAudit.status === 'good'" name="shield-checkmark"></ion-icon>
        <ion-icon *ngIf="securityAudit.status === 'warning'" name="shield-half"></ion-icon>
        <ion-icon *ngIf="securityAudit.status === 'critical'" name="shield-alert"></ion-icon>
      </div>
      <div class="security-info">
        <h4>Security Audit: {{ securityAudit.status | titlecase }}</h4>
        <p>{{ securityAudit.message }}</p>
      </div>
    </div>

    <!-- Form Section -->
    <form [formGroup]="setupForm" (ngSubmit)="onSubmit()" class="waitlist-form">
      <!-- Email Field -->
      <div class="form-group">
        <ion-item lines="none" class="custom-input">
          <ion-label position="stacked">Waitlist Email</ion-label>
          <ion-input 
            type="email" 
            formControlName="email"
            placeholder="Enter your waitlist email"
            [disabled]="isLoading">
          </ion-input>
        </ion-item>
        <div *ngIf="setupForm.get('email')?.touched && setupForm.get('email')?.invalid" class="error-message">
          <span *ngIf="setupForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="setupForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
        </div>
      </div>

      <!-- Passphrase Field -->
      <div class="form-group">
        <ion-item lines="none" class="custom-input">
          <ion-label position="stacked">Passphrase</ion-label>
          <ion-input 
            [type]="hidePassphrase ? 'password' : 'text'" 
            formControlName="passphrase"
            placeholder="Enter your secure passphrase"
            [disabled]="isLoading">
          </ion-input>
          <ion-button 
            slot="end" 
            fill="clear"
            size="small"
            (click)="togglePassphraseVisibility()">
            <ion-icon [name]="hidePassphrase ? 'eye' : 'eye-off'"></ion-icon>
          </ion-button>
        </ion-item>

        <!-- Passphrase Validation Feedback -->
        <div *ngIf="passphraseValidation && setupForm.get('passphrase')?.value" class="passphrase-feedback">
          <div class="strength-meter">
            <div class="strength-bar" [ngClass]="getStrengthColor()"></div>
          </div>
          <div class="strength-text" [ngClass]="getStrengthColor()">
            <span>{{ passphraseValidation.strength | titlecase }}</span>
            <ion-icon 
              [name]="passphraseValidation.strength === 'strong' ? 'checkmark-circle' : 'alert-circle'"
              [ngClass]="getStrengthColor()">
            </ion-icon>
          </div>
          <p class="strength-message">{{ passphraseValidation.message }}</p>
        </div>

        <div *ngIf="setupForm.get('passphrase')?.touched && setupForm.get('passphrase')?.invalid" class="error-message">
          <span *ngIf="setupForm.get('passphrase')?.errors?.['required']">Passphrase is required</span>
          <span *ngIf="setupForm.get('passphrase')?.errors?.['minlength']">Passphrase must be at least 12 characters</span>
        </div>
      </div>

      <!-- Recovery Options (Conditional) -->
      <div class="recovery-section">
        <div class="recovery-header" (click)="toggleRecoveryOptions()">
          <h3>Trouble signing in?</h3>
          <ion-icon [name]="showRecoveryOptions ? 'chevron-up' : 'chevron-down'"></ion-icon>
        </div>
        
        <div *ngIf="showRecoveryOptions" class="recovery-options">
          <p class="recovery-info">
            If you forgot your passphrase, you can recover using your emergency recovery phrase.
          </p>
          
          <ion-item lines="none" class="custom-input">
            <ion-label position="stacked">Recovery Phrase (Optional)</ion-label>
            <ion-textarea 
              formControlName="recoveryPhrase"
              placeholder="Enter your recovery phrase if you have one"
              [disabled]="isLoading">
            </ion-textarea>
          </ion-item>
        </div>
      </div>

      <!-- Submit Button -->
      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="setupForm.invalid || isLoading"
        class="submit-button">
        <span>Access My Account</span>
        <ion-icon name="log-in-outline" slot="end"></ion-icon>
      </ion-button>

      <!-- Standard Registration Option -->
      <div class="alternative-option">
        <p>Not on the waitlist?</p>
        <a (click)="navigateToStandardRegistration()">Create a standard account</a>
      </div>
    </form>

    <!-- Footer -->
    <div class="footer">
      <p>Need help? <a href="#">Contact Support</a></p>
    </div>
  </div>
</ion-content>
